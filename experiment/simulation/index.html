<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2-Phase Commit Protocol Simulation</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>
                2-Phase Commit Protocol
                <div class="status-indicator"></div>
            </h1>
            <div style="font-size: 0.9em; opacity: 0.9;">
                Distributed Transaction Simulation
            </div>
        </header>

        <!-- Mobile Tab Navigation -->
        <nav class="mobile-tab-nav" id="mobileTabNav">
            <button class="mobile-tab-btn" data-tab="controls">
                ‚öôÔ∏è <span class="tab-text">Controls</span>
            </button>
            <button class="mobile-tab-btn active" data-tab="simulation">
                üéØ <span class="tab-text">Simulation</span>
            </button>
            <button class="mobile-tab-btn" data-tab="observations">
                üìä <span class="tab-text">Logs</span>
            </button>
        </nav>

        <div class="controls-panel" id="controlsPanel">
            <div class="control-section">
                <h3>Transaction Configuration</h3>
                <div class="input-group">
                    <label>Number of Participants</label>
                    <select id="participantCount">
                        <option value="3">3 Participants</option>
                        <option value="4">4 Participants</option>
                        <option value="5">5 Participants</option>
                        <option value="6">6 Participants</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Failure Scenario</label>
                    <select id="failureMode">
                        <option value="none">No Failures</option>
                        <option value="coordinator_phase1">Coordinator Fails (Phase 1)</option>
                        <option value="coordinator_phase2">Coordinator Fails (Phase 2)</option>
                        <option value="participant_phase1">Participant Fails (Phase 1)</option>
                        <option value="participant_phase2">Participant Fails (Phase 2)</option>
                        <option value="network_partition">Network Partition</option>
                        <option value="timeout">Transaction Timeout</option>
                    </select>
                </div>
            </div>

            <div class="control-section">
                <h3>Actions & Controls</h3>
                <div class="input-group">
                    <label>Animation Speed</label>
                    <div class="control-row">
                        <input type="range" id="animationSpeed" min="0.25" max="3" step="0.25" value="1" style="flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; outline: none; -webkit-appearance: none; appearance: none; cursor: pointer;">
                        <div id="speedValue" style="min-width: 40px; text-align: center; color: #1e40af; font-weight: 600; font-size: 0.9rem; background: white; border-radius: 6px; padding: 4px 8px; border: 1px solid #e2e8f0;">1x</div>
                    </div>
                </div>
                <div class="input-group">
                    <label>Simulation Mode</label>
                    <select id="simulationMode">
                        <option value="manual">Step-by-step (Manual)</option>
                        <option value="automatic">Automatic</option>
                    </select>
                </div>

                <!-- Manual Controls -->
                <div id="manualControls">
                    <button id="nextStepBtn" class="btn btn-primary">‚û°Ô∏è Next Step</button>
                </div>

                <!-- Automatic Controls -->
                <div id="automaticControls" style="display: none;">
                    <button id="runAutoBtn" class="btn btn-secondary">‚ñ∂Ô∏è Run Simulation</button>
                </div>
                
                <button id="resetSimulation" class="btn btn-danger">üîÑ Reset Simulation</button>
            </div>
        </div>

        <div class="experiment-area active" id="experimentArea">
            <div class="simulation-area">
                <div class="legend-panel">
                    <h4>Legend</h4>
                    <div class="legend-items">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #3182ce, #2c5282);"></div>
                            <span>Coordinator</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #63b3ed, #4299e1);"></div>
                            <span>Participant (Ready)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #48bb78, #38a169);"></div>
                            <span>Voted Yes</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #ed8936, #dd6b20);"></div>
                            <span>Voted No</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #f56565, #e53e3e);"></div>
                            <span>Failed Node</span>
                        </div>
                    </div>
                </div>
                <div id="phaseIndicator" class="phase-indicator">Ready</div>
                <div class="coordinator" id="coordinator">
                    Coordinator
                </div>
                <div class="participants" id="participants"></div>
                <div class="message-lines" id="messageLines"></div>
                <div class="failure-overlay" id="failureOverlay">
                    System Failure Detected!
                </div>
            </div>
        </div>

        <div class="observations-panel" id="observationsPanel">
            <div class="status-section">
                <h4>Transaction Log</h4>
                <div class="logs" id="logContainer">
                    <div class="log-entry info">[System] 2-Phase Commit Protocol initialized</div>
                    <div class="log-entry info">[Info] Click 'Start Transaction' to begin distributed transaction</div>
                </div>
            </div>

            <div class="status-section">
                <h4>Process State</h4>
                <div class="process-state-container">
                    <div class="process-node">
                        <div class="process-node-header">
                            <span class="process-node-icon">üéØ</span>
                            <span class="process-node-name">Coordinator</span>
                            <span class="process-status-badge" id="coordinatorStatus">Ready</span>
                        </div>
                        <div class="process-node-details" id="coordinatorDetails">
                            <div class="detail-item">State: <span class="detail-value">Idle</span></div>
                        </div>
                    </div>
                    <div class="participants-state" id="participantsState">
                        <!-- Participant states will be dynamically added here -->
                    </div>
                </div>
            </div>

            <div class="status-section">
                <h4>Transaction Statistics</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="successCount">0</div>
                        <div class="stat-label">Successful Commits</div>
                        <div class="stat-description">Transactions completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="abortCount">0</div>
                        <div class="stat-label">Aborted Transactions</div>
                        <div class="stat-description">Transactions rolled back</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="failureCount">0</div>
                        <div class="stat-label">System Failures</div>
                        <div class="stat-description">Node/network failures</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTransactions">0</div>
                        <div class="stat-label">Total Transactions</div>
                        <div class="stat-description">All attempts</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <!-- Mobile Portrait Orientation Overlay -->
    <div class="rotate-device-overlay">
        <div class="rotate-icon">üì±‚û°Ô∏èüì≤</div>
        <h2>Please Rotate Your Device</h2>
        <p>For the best experience, please rotate your device to landscape mode to view this distributed systems simulation.</p>
    </div>

    <script src="script.js"></script>
</body>
</html>